<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Performs conversion of the AmsterdamUMCdb to the OMOP Common Data Model
   Contains the ETL Description, ETL Code and mapping documents. Named after the famous river
   flowing through the city of Amsterdam.">
<title>AmsterdamUMCdb extracting, transforming and loading (ETL) into the OMOP Common Data Model • amstel</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="AmsterdamUMCdb extracting, transforming and loading (ETL) into the OMOP Common Data Model">
<meta property="og:description" content="Performs conversion of the AmsterdamUMCdb to the OMOP Common Data Model
   Contains the ETL Description, ETL Code and mapping documents. Named after the famous river
   flowing through the city of Amsterdam.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-secondary"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">amstel</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1.0000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="dqd/index.html">Data Quality Dashboard</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/AmsterdamUMC/AMSTEL/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><p><img src="https://github.com/AmsterdamUMC/AMSTEL/blob/main/img/logo_c4i_square.png?raw=1" alt="Logo C4I" width="128px"><img src="https://github.com/AmsterdamUMC/AMSTEL/blob/main/img/logo_amds.png?raw=1" alt="Logo AMDS" width="128px/"><img src="https://github.com/AmsterdamUMC/AMSTEL/blob/main/img/lala.png?raw=1" alt="LaLa" width="128px/"><img src="https://github.com/AmsterdamUMC/AMSTEL/blob/main/img/gaia.png?raw=1" alt="Gaia Scientific" width="128px/"><img src="https://github.com/AmsterdamUMC/AMSTEL/blob/main/img/ehden.png?raw=1" alt="EHDEN Foundation" width="128px/"></p>
<div class="section level1">
<div class="page-header"><h1 id="amstel-amsterdamumcdb---omop-common-data-model-etl">AMSTEL: AmsterdamUMCdb - OMOP Common Data Model ETL<a class="anchor" aria-label="anchor" href="#amstel-amsterdamumcdb---omop-common-data-model-etl"></a>
</h1></div>
<p>The <code>AMSTEL</code> GitHub respository and <code>amstel</code> R package were developed to convert <a href="https://www.github.com/AmsterdamUMC/AmsterdamUMCdb" class="external-link">AmsterdamUMCdb</a>, the first freely accessible European intensive care database, to the <a href="https://ohdsi.github.io/CommonDataModel/cdm54.html" class="external-link">Observational Medical Outcomes Partnership Common Data Model version 5.4</a> (OMOP CDM 5.4) maintained by the <a href="https://www.ohdsi.org/" class="external-link">Observational Health Data Sciences and Informatics</a> (OHDSI) community.</p>
<p>This repository contains a collection of resources, mainly documentation, R scripts, SQL queries and mapping files, that form the ETL (Extract, Transform, and Load) process for converting AmsterdamUMCdb to the OMOP Common Data Model. The <code>amstel</code> R package documentation, created with <a href="https://pkgdown.r-lib.org/" class="external-link"><code>pkgdown</code></a> is available <a href="https://amsterdamumc.github.io/AMSTEL/">here</a>.</p>
<p>The ETL for AmsterdamUMCdb is based on the excellent and well-documented ETL of the Sythea project available at: <a href="https://github.com/OHDSI/ETL-Synthea" class="external-link uri">https://github.com/OHDSI/ETL-Synthea</a>.</p>
<p>In this document we describe the steps that were taken to convert AmsterdamUMCdb to the OMOP Common Data Model. When steps are only needed to develop an ETL, and not for the actual conversion of AmsterdamUMC to the CDM, we have added the remark <em>Development Only</em>.</p>
<p>Currently, to create an environment that contains the complete OHDSI software stack, a number of installation steps have to be taken to be able to fully utilize the data in the CDM. Since many tutorials were written for Microsoft Windows, this document explicitly contains documentation to use a full open source environment running on Ubuntu, but should equally well run on any other modern operating system.</p>
<p>The <code>AMSTEL</code> project is a collaboration between the Center for Critical Care Computational Intelligence of <a href="https://www.amsterdamumc.nl/" class="external-link">Amsterdam UMC</a>, <a href="https://amsterdammedicaldatascience.nl/" class="external-link">Amsterdam Medical Data Science</a>, <a href="http://lalacongres.eu/" class="external-link">Stichting LaLa</a>, <a href="https://www.gaiascientific.com/" class="external-link">Gaia Scientific</a> and the <a href="https://www.ehden.eu/" class="external-link">European Health Data &amp; Evidence Network</a>.</p>
</div>
<div class="section level1">
<h1 id="funding">Funding<a class="anchor" aria-label="anchor" href="#funding"></a>
</h1>
<p>This project has received funding from the Innovative Medicines Initiative 2 Joint Undertaking (JU) under grant agreement No 806968. The JU receives support from the European Union’s Horizon 2020 research and innovation programme and EFPIA.</p>
</div>
<div class="section level1">
<h1 id="requirements">Requirements<a class="anchor" aria-label="anchor" href="#requirements"></a>
</h1>
<ul>
<li>AmsterdamUMCDb version 1.0.2 installed in a supported relational database management system (RDBMS), preferably PostgreSQL.</li>
<li>Read access to the database containing AmsterdamUMCdb</li>
<li>Read/write access to an (empty) database for creating the required CDM schemas</li>
<li>600 GB or more disk space during conversion, 300 GB after successful conversion.</li>
</ul>
<p>Development was performed on a Hyper-V based Ubuntu 22.04 LTS virtual machine (12 virtual cores, 64 GB RAM, 1 TB SSD based virtual disk)</p>
<p><strong>Note</strong>: the SQL queries in this repository have been written in OHDSI SQL, a subset of the SQL Server SQL dialect. The functions as part of the <code>amstel</code> package that perform database transactions make use of the OHDSI <a href="https://ohdsi.github.io/DatabaseConnector/" class="external-link">DatabaseConnector</a> package to convert queries in this dialect into SQL queries that should work on various database systems. However, testing has currently only been performed against PostgreSQL, since <a href="https://github.com/OHDSI/WebAPI" class="external-link">OHDSI WebAPI</a> dropped support for other RDBMS and requires PostgreSQL to store its data.</p>
</div>
<div class="section level1">
<h1 id="install-r-with-rstudio">Install R with RStudio<a class="anchor" aria-label="anchor" href="#install-r-with-rstudio"></a>
</h1>
<div class="section level2">
<h2 id="install-r">Install R<a class="anchor" aria-label="anchor" href="#install-r"></a>
</h2>
<p>The default <code>sudo apt install r-base</code> installs version 4.1.2 on Ubuntu. To install the most recent version, run these commands in the terminal (source: <a href="https://cran.r-project.org/bin/linux/ubuntu/" class="external-link uri">https://cran.r-project.org/bin/linux/ubuntu/</a>):</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># update indices</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">sudo</span> apt update <span class="at">-qq</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co"># install two helper packages we need</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">sudo</span> apt install <span class="at">--no-install-recommends</span> software-properties-common dirmngr</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co"># add the signing key (by Michael Rutter) for these repos</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co"># To verify key, run gpg --show-keys /etc/apt/trusted.gpg.d/cran_ubuntu_key.asc </span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co"># Fingerprint: E298A3A825C0D65DFD57CBB651716619E084DAB9</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="fu">wget</span> <span class="at">-qO-</span> https://cloud.r-project.org/bin/linux/ubuntu/marutter_pubkey.asc <span class="kw">|</span> <span class="fu">sudo</span> tee <span class="at">-a</span> /etc/apt/trusted.gpg.d/cran_ubuntu_key.asc</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="co"># add the R 4.0 repo from CRAN -- adjust 'focal' to 'groovy' or 'bionic' as needed</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="fu">sudo</span> add-apt-repository <span class="st">"deb https://cloud.r-project.org/bin/linux/ubuntu </span><span class="va">$(</span><span class="ex">lsb_release</span> <span class="at">-cs</span><span class="va">)</span><span class="st">-cran40/"</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="fu">sudo</span> apt install <span class="at">--no-install-recommends</span> r-base</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="install-rstudio-server">Install RStudio server<a class="anchor" aria-label="anchor" href="#install-rstudio-server"></a>
</h2>
<p>Follow the instructions on <a href="https://posit.co/download/rstudio-server/" class="external-link uri">https://posit.co/download/rstudio-server/</a> to determine the correct version.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">sudo</span> apt-get install gdebi-core</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">wget</span> https://download2.rstudio.org/server/jammy/amd64/rstudio-server-2023.03.0-386-amd64.deb</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="fu">sudo</span> gdebi rstudio-server-2023.03.0-386-amd64.deb</span></code></pre></div>
<p>Alteratively, you could install R-studio Desktop if you only intend to use R from your local machine from <a href="https://posit.co/download/rstudio-desktop/" class="external-link">here</a>.</p>
</div>
</div>
<div class="section level1">
<h1 id="clone-the-amstel-github-repository">Clone the AMSTEL Github repository<a class="anchor" aria-label="anchor" href="#clone-the-amstel-github-repository"></a>
</h1>
<p>The AMSTEL Github respository contains mapping data and a folder structure to succcesfully combine the required data for running the ETL.</p>
<div class="section level2">
<h2 id="install-git">Install git<a class="anchor" aria-label="anchor" href="#install-git"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">sudo</span> apt install git</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="clone-the-repository">Clone the repository<a class="anchor" aria-label="anchor" href="#clone-the-repository"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/AmsterdamUMC/AMSTEL</span></code></pre></div>
</div>
</div>
<div class="section level1">
<h1 id="install-java-development-kit">Install Java Development Kit<a class="anchor" aria-label="anchor" href="#install-java-development-kit"></a>
</h1>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">sudo</span> apt install default-jdk</span></code></pre></div>
<p>This will install the default Java Development Kit</p>
</div>
<div class="section level1">
<h1 id="setup-a-new-postgresql-user">Setup a new PostgreSQL user<a class="anchor" aria-label="anchor" href="#setup-a-new-postgresql-user"></a>
</h1>
<p>If working from a (virtual) machine that differs from the database server, you may be required to set up a new user with Superuser privileges using pgAdmin (default postgres). In addition, a standard postgreSQL setup will require adding the following line to the <code>pg_hba.conf</code> file in the root of your PostgreSQL installation path to allow your machine to connect to the databaser server:</p>
<pre><code># add permission to query database from OHDSI (virtual) machine
host all &lt;&lt;your username&gt;&gt; &lt;&lt;your hostname&gt;&gt; scram-sha-256</code></pre>
</div>
<div class="section level1">
<h1 id="install-whiterabbit">Install WhiteRabbit<a class="anchor" aria-label="anchor" href="#install-whiterabbit"></a>
</h1>
<p><em>Development only</em></p>
<p>OHDSI <a href="https://github.com/OHDSI/WhiteRabbit" class="external-link">WhiteRabbit</a> is an application to analyse the structure and contents of a database as preparation for designing an ETL. It comes with RabbitInAHat, an application for interactive design of an ETL to the OMOP Common Data Model with the help of the scan report generated by White Rabbit.</p>
<p><strong>Required steps</strong></p>
<ul>
<li>Install the application by following the instructions on the <a href="https://github.com/OHDSI/WhiteRabbit" class="external-link">WhiteRabbit</a> Github page.</li>
<li>Run WhiteRabbit and connect to the PostgreSQL database to generate the report.</li>
</ul>
<p>The report generated by WhiteRabbit for AmsterdamUMCdb can be found <a href="./data/whiterabbit/ScanReport.xlsx">here</a>.</p>
<p>The ETL design developed for AmsterdamUMCdb using RabbitInAHat can be found <a href="./data/whiterabbit/AmsterdamUMCdb-ETL.json.gz">here</a>. You can open this file from within the RabbitInAHat application.</p>
</div>
<div class="section level1">
<h1 id="download-vocabularies-from-athena">Download Vocabularies from Athena<a class="anchor" aria-label="anchor" href="#download-vocabularies-from-athena"></a>
</h1>
<p>The (standard) vocabularies are an important part of the Common Data Model.</p>
<ul>
<li>Open <a href="https://athena.ohdsi.org/search-terms/start" class="external-link uri">https://athena.ohdsi.org/search-terms/start</a>.</li>
<li>Login or Create new account using Register</li>
<li>Click Download, select the (default) vocabularies</li>
<li>Unzip the files and place them in the <a href="./data/vocabulary/">vocabulary</a> folder.</li>
</ul>
</div>
<div class="section level1">
<h1 id="install-usagi">Install Usagi<a class="anchor" aria-label="anchor" href="#install-usagi"></a>
</h1>
<p><em>Development only</em></p>
<p>OHDSI <a href="https://github.com/OHDSI/Usagi" class="external-link">Usagi</a> is an application to help create mappings between coding systems and the Vocabulary standard concepts.</p>
<p>The files containing the source (AmsterdamUMCdb) concepts can be found <a href="./data/source_concepts/">here</a>. The (final) mapping files created using Usagi and that will be used in the ETL can be found <a href="./data/mappings/">here</a>.</p>
</div>
<div class="section level1">
<h1 id="setup-google-translate-cloud-api">Setup Google Translate Cloud API<a class="anchor" aria-label="anchor" href="#setup-google-translate-cloud-api"></a>
</h1>
<p><em>Development only</em></p>
<p>The Usagi software uses the names of the concepts to find a matching standard concept in the Vocabulary. Since AmsterdamUMCdb was sourced from a Dutch patient data management system, most concepts can not be used directly to find a corresponding English concept. Follow the tutorial here to setup R to use Google Translate to translate these Dutch concepts to English to improving matching by the Usagi mapping tool: <a href="https://github.com/ropensci/googleLanguageR" class="external-link uri">https://github.com/ropensci/googleLanguageR</a></p>
<p>After creating the JSON credentials file, save this file as <code>~/.config/amstel/credentials.json</code></p>
</div>
<div class="section level1">
<h1 id="install-hades">Install Hades<a class="anchor" aria-label="anchor" href="#install-hades"></a>
</h1>
<p>OHDSI <a href="https://ohdsi.github.io/Hades/" class="external-link">HADES</a> is a set of open source R packages for large scale analytics, including population characterization, population-level causal effect estimation, and patient-level prediction. In the context of th ETL, this will be used perform checks and aggregations by the <a href="https://ohdsi.github.io/Achilles/" class="external-link">Achilles</a> and <a href="https://ohdsi.github.io/DataQualityDashboard/" class="external-link">DataQualityDashboard</a> packages.</p>
<div class="section level2">
<h2 id="install-cmake">Install cmake<a class="anchor" aria-label="anchor" href="#install-cmake"></a>
</h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">sudo</span> apt install cmake libsodium-dev</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="install-hades-packages">Install HADES packages<a class="anchor" aria-label="anchor" href="#install-hades-packages"></a>
</h2>
<p>Follow the tutorial here: <a href="https://ohdsi.github.io/Hades/installingHades.html" class="external-link uri">https://ohdsi.github.io/Hades/installingHades.html</a>. Please note the <em>requirement</em> for setting up a GitHub Personal Access Token (PAT).</p>
</div>
</div>
<div class="section level1">
<h1 id="install-the-amstel-package">Install the <code>amstel</code> package<a class="anchor" aria-label="anchor" href="#install-the-amstel-package"></a>
</h1>
<p>Open RStudio, choose <code>File</code> &gt; <code>Open Project...</code> and open the <code>amstel.Rproj</code> project from the cloned AMSTEL Github repository.</p>
<p>From the R console, run:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install the `amstel` package from the github repository</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"AmsterdamUMC/AMSTEL"</span><span class="op">)</span> </span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/AmsterdamUMC/AMSTEL" class="external-link">amstel</a></span><span class="op">)</span></span></code></pre></div>
<p>This will install the <code>amstel</code> package from GitHub and imports the package into the R environment.</p>
</div>
<div class="section level1">
<h1 id="configure-database-connections">Configure database connections<a class="anchor" aria-label="anchor" href="#configure-database-connections"></a>
</h1>
<p>Before the ETL can start, we will need to define the settings to connect to the database servers, and optionally change the names of the schemas we’d like to use to store the CDM data into. In addition, we can change the locations of a number of required data sources, including the vocabularies, but it is recommended to leave them at their defaults.</p>
<p>From the R console, run:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">amstel</span><span class="fu">::</span><span class="fu"><a href="reference/create_config.html">create_config</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>This wil create a new configuration file (<code>config.yaml</code>) at the OS specified location for user settings and opens this file in RStudio for editing. While most settings kan be kept to their defaults, please make sure to set the correct database type, server, username and password for all database schemas (AmsterdamUMCdb, cdm, results, temp).</p>
</div>
<div class="section level1">
<h1 id="download-required-database-drivers">Download required database drivers<a class="anchor" aria-label="anchor" href="#download-required-database-drivers"></a>
</h1>
<p>Based on the configuration file above, the correct drivers to connect to the source and target databases will need to be downloaded once. The drivers by default, will be stored <a href="./data/jdbc_drivers/">here</a>, unless the location has been changed in the <code>config.yaml</code> file. From the R console, run:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">amstel</span><span class="fu">::</span><span class="fu"><a href="reference/download_drivers.html">download_drivers</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level1">
<h1 id="run-the-etl">Run the ETL<a class="anchor" aria-label="anchor" href="#run-the-etl"></a>
</h1>
<p>To continue using RStudio while running the ETL, it is recommended to run the ETL as a background job since the ETL, data quality checks and aggregation can take between hours and days depending on the performance of the database server.</p>
<p>From the <code>Background Jobs</code> panel, choose <code>Start Background Job</code>, use <code>Browse</code> to select the <a href="./inst/scripts/ETL_background_job.R">/inst/scripts/ETL_background_job.R</a> script. Make sure the <code>Working Directory</code> is set to the directory of the local clone of the AMSTEL GitHub repository, unless you have specified an absolute path to the repository in the <code>configuration.yaml</code> file.</p>
<p>Alternatively, from the R console, you could also run:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">amstel</span><span class="fu">::</span><span class="fu"><a href="reference/etl.html">etl</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>During the ETL, the process will be logged to both the console as wel as the <a href="./logs/">logs</a> folder, unless the defaults have been changed.</p>
</div>
<div class="section level1">
<h1 id="install-atlas">Install ATLAS<a class="anchor" aria-label="anchor" href="#install-atlas"></a>
</h1>
<p>OHDSI <a href="https://github.com/OHDSI/Atlas" class="external-link">ATLAS</a> is an open source software tool for researchers to conduct scientific analyses on standardized observational data converted to the OMOP Common Data Model V5. It also enables you to graphically browse the reports generated by the ACHILLES aggregation tool.</p>
<p>To install ATLAS, we will need to install its dependencies first. ## Install WebAPI OHDSI <a href="https://github.com/OHDSI/WebAPI" class="external-link">WebAPI</a> contains all OHDSI RESTful services that can be called from OHDSI applications including ATLAS. Multiple steps are needed to install WebAPI. ### Install Java 8 JDK</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">sudo</span> apt-get install openjdk-8-jdk</span></code></pre></div>
<p>Before running Maven make sure to set the build environment to the version 8 JRE</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="bu">export</span> <span class="va">JAVA_HOME</span><span class="op">=</span>/usr/lib/jvm/java-1.8.0-openjdk-amd64/jre/</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="bu">export</span> <span class="va">JRE_HOME</span><span class="op">=</span>/usr/lib/jvm/java-1.8.0-openjdk-amd64/jre/</span></code></pre></div>
<div class="section level3">
<h3 id="maven">Maven<a class="anchor" aria-label="anchor" href="#maven"></a>
</h3>
<p>The latest versions can be found here: <a href="https://maven.apache.org/download.cgi" class="external-link uri">https://maven.apache.org/download.cgi</a></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">sudo</span> apt install maven</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="tomcat-80">Tomcat 8.0<a class="anchor" aria-label="anchor" href="#tomcat-80"></a>
</h3>
<p>WebAPI that was built using the Java 8 SDK currently requires Tomcat 8.0, due to changes in newer versions according to the <a href="https://tomcat.apache.org/download-10.cgi" class="external-link">Apache Tomcat Documentation</a>:</p>
<pre><code>Users of Tomcat 10 onwards should be aware that, as a result of the move from Java EE to Jakarta EE as part of the transfer of Java EE to the Eclipse Foundation, the primary package for all implemented APIs has changed from javax.* to jakarta.*. This will almost certainly require code changes to enable applications to migrate from Tomcat 9 and earlier to Tomcat 10 and later. A migration tool has been developed to aid this process.</code></pre>
<div class="section level4">
<h4 id="create-a-separate-tomcat-user">Create a separate Tomcat user<a class="anchor" aria-label="anchor" href="#create-a-separate-tomcat-user"></a>
</h4>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">sudo</span> groupadd tomcat</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="fu">sudo</span> useradd <span class="at">-s</span> /bin/false <span class="at">-g</span> tomcat <span class="at">-d</span> /opt/tomcat tomcat</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="download-the-latest-tomcat-80-binaries">Download the latest Tomcat 8.0 binaries<a class="anchor" aria-label="anchor" href="#download-the-latest-tomcat-80-binaries"></a>
</h4>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="bu">cd</span> /tmp</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="fu">wget</span> https://dlcdn.apache.org/tomcat/tomcat-8/v8.5.95/bin/apache-tomcat-8.5.95.tar.gz</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="create-installation-folder">Create installation folder<a class="anchor" aria-label="anchor" href="#create-installation-folder"></a>
</h4>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="fu">sudo</span> mkdir /opt/tomcat</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a><span class="bu">cd</span> /opt/tomcat</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="extract-files">Extract files<a class="anchor" aria-label="anchor" href="#extract-files"></a>
</h4>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">sudo</span> tar xzvf /tmp/apache-tomcat-8.5.95.tar.gz <span class="at">-C</span> /opt/tomcat <span class="at">--strip-components</span><span class="op">=</span>1</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="fu">sudo</span> chgrp <span class="at">-R</span> tomcat /opt/tomcat</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="fu">sudo</span> chmod <span class="at">-R</span> g+r conf</span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="fu">sudo</span> chmod g+x conf</span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="fu">sudo</span> chown <span class="at">-R</span> tomcat webapps/ work/ temp/ logs/</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="create-service-for-tomcat">create service for tomcat<a class="anchor" aria-label="anchor" href="#create-service-for-tomcat"></a>
</h4>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">sudo</span> nano /etc/systemd/system/tomcat.service</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="fu">sudo</span> systemctl daemon-reload</span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="install-webapi">Install WebAPI<a class="anchor" aria-label="anchor" href="#install-webapi"></a>
</h3>
<div class="section level4">
<h4 id="clone-repository">Clone repository<a class="anchor" aria-label="anchor" href="#clone-repository"></a>
</h4>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/OHDSI/WebAPI.git</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="checkout-release">Checkout release<a class="anchor" aria-label="anchor" href="#checkout-release"></a>
</h4>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="bu">cd</span> WebAPI/</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="fu">git</span> checkout refs/tags/v2.13.0</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="create-settingsxml">Create <code>settings.xml</code>
<a class="anchor" aria-label="anchor" href="#create-settingsxml"></a>
</h4>
<p>In the root of the WebAPI repository folder, there is a file named <code>sample_settings.xml</code>. Copy this file into a new folder WebAPIConfig and rename it to <code>settings.xml</code>.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="fu">mkdir</span> WebAPIConfig</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a><span class="fu">cp</span> sample_settings.xml WebAPIConfig/settings.xml</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="configure-the-settingsxml-file">Configure the <code>settings.xml</code> file<a class="anchor" aria-label="anchor" href="#configure-the-settingsxml-file"></a>
</h4>
<p>See the information as specified in the offical <a href="https://github.com/OHDSI/WebAPI/wiki/WebAPI-Installation-Guide#configure-the-maven-profile" class="external-link">documentation</a> to configure the Maven profile in the <code>settings.xml</code> file</p>
<blockquote>
<p>nano WebAPIConfig/settings.xml</p>
</blockquote>
</div>
<div class="section level4">
<h4 id="building-the-webapi-war-file-using-maven">Building the WebAPI .war file using Maven<a class="anchor" aria-label="anchor" href="#building-the-webapi-war-file-using-maven"></a>
</h4>
<blockquote>
<p>mvn clean package -DskipUnitTests -DskipITtests -s WebAPIConfig/settings.xml -P webapi-postgresql</p>
</blockquote>
</div>
<div class="section level4">
<h4 id="deploy-webapi-to-tomcat">Deploy WebAPI to Tomcat<a class="anchor" aria-label="anchor" href="#deploy-webapi-to-tomcat"></a>
</h4>
<div class="section level5">
<h5 id="edit-the-tomcat-usersxml-file">Edit the tomcat-users.xml file<a class="anchor" aria-label="anchor" href="#edit-the-tomcat-usersxml-file"></a>
</h5>
<blockquote>
<p>sudo nano /opt/tomcat/conf/tomcat-users.xml</p>
</blockquote>
<p>Add to <code>&lt;tomcat-users&gt;</code> block</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>&lt;<span class="kw">role</span><span class="ot"> rolename=</span><span class="st">"manager-gui"</span>/&gt;</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>  &lt;<span class="kw">user</span><span class="ot"> username=</span><span class="st">"tomcat"</span><span class="ot"> password=</span><span class="st">"</span><span class="er">&lt;&lt;</span><span class="st">my_tomcat_password&gt;&gt;"</span><span class="ot"> roles=</span><span class="st">"manager-gui"</span>/&gt;</span></code></pre></div>
<p>Edit settings to allow large uploads:</p>
<blockquote>
<p>sudo nano /opt/tomcat/webapps/manager/WEB-INF/web.xml</p>
</blockquote>
<div class="sourceCode" id="cb25"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>    &lt;<span class="kw">multipart-config</span>&gt;</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>      <span class="co">&lt;!-- 50MB max --&gt;</span></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>      &lt;<span class="kw">max-file-size</span>&gt;52428800&lt;/<span class="kw">max-file-size</span>&gt;</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>      &lt;<span class="kw">max-request-size</span>&gt;52428800&lt;/<span class="kw">max-request-size</span>&gt;</span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>      &lt;<span class="kw">file-size-threshold</span>&gt;0&lt;/<span class="kw">file-size-threshold</span>&gt;</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>    &lt;/<span class="kw">multipart-config</span>&gt;</span></code></pre></div>
<p>Update this to read:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>    &lt;<span class="kw">multipart-config</span>&gt;</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>      <span class="co">&lt;!-- 1024MB max --&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>      &lt;<span class="kw">max-file-size</span>&gt;1073741824&lt;/<span class="kw">max-file-size</span>&gt;</span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a>      &lt;<span class="kw">max-request-size</span>&gt;1073741824&lt;/<span class="kw">max-request-size</span>&gt;</span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a>      &lt;<span class="kw">file-size-threshold</span>&gt;0&lt;/<span class="kw">file-size-threshold</span>&gt;</span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>    &lt;/<span class="kw">multipart-config</span>&gt;</span></code></pre></div>
</div>
</div>
<div class="section level4">
<h4 id="run-tomcat">Run Tomcat<a class="anchor" aria-label="anchor" href="#run-tomcat"></a>
</h4>
<blockquote>
<p>sudo /opt/tomcat/bin/startup.sh run</p>
</blockquote>
</div>
<div class="section level4">
<h4 id="deploy-webapi-using-tomcat-application-manager">Deploy WebAPI using Tomcat Application Manager<a class="anchor" aria-label="anchor" href="#deploy-webapi-using-tomcat-application-manager"></a>
</h4>
<p>Open a web browser, navigate to <a href="http://localhost:8080/manager" class="external-link uri">http://localhost:8080/manager</a> and you will be prompted for credentials. Enter the username of <code>tomcat</code> and password <code>&lt;&lt;my_tomcat_password&gt;&gt;</code> configured in the step above.</p>
<p>You will then see the manager screen. At the bottom of the manager screen, you will see an area labled <code>WAR file to deploy</code>. Click on the <code>Choose File</code> button and navigate to the location of the WebAPI.war file created in one of the previous steps. Click the <code>Deploy</code> button to deploy and start up WebAPI.</p>
</div>
<div class="section level4">
<h4 id="verify-connection">Verify connection<a class="anchor" aria-label="anchor" href="#verify-connection"></a>
</h4>
<p>Verify succesfull installation of WebAPI by navigating to: <a href="http://localhost:8080/WebAPI/info" class="external-link uri">http://localhost:8080/WebAPI/info</a>. You should receive a json object containg the version info, e.g.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="fu">{</span><span class="dt">"version"</span><span class="fu">:</span><span class="st">"2.13.0"</span><span class="fu">,</span><span class="dt">"buildInfo"</span><span class="fu">:{</span><span class="dt">"artifactVersion"</span><span class="fu">:</span><span class="st">"WebAPI 2.13.0"</span><span class="fu">,</span><span class="dt">"build"</span><span class="fu">:</span><span class="st">"NA"</span><span class="fu">,</span><span class="dt">"timestamp"</span><span class="fu">:</span><span class="st">"Fri Oct 27 23:25:17 UTC 2023"</span><span class="fu">,</span><span class="dt">"branch"</span><span class="fu">:</span><span class="st">"b4acb3a27962207aec132b5e79dafa181c41f1da"</span><span class="fu">,</span><span class="dt">"commitId"</span><span class="fu">:</span><span class="st">"b4acb3a"</span><span class="fu">,</span><span class="dt">"atlasRepositoryInfo"</span><span class="fu">:{</span><span class="dt">"milestoneId"</span><span class="fu">:</span><span class="dv">42</span><span class="fu">,</span><span class="dt">"releaseTag"</span><span class="fu">:</span><span class="st">"*"</span><span class="fu">},</span><span class="dt">"webapiRepositoryInfo"</span><span class="fu">:{</span><span class="dt">"milestoneId"</span><span class="fu">:</span><span class="dv">43</span><span class="fu">,</span><span class="dt">"releaseTag"</span><span class="fu">:</span><span class="st">"*"</span><span class="fu">}},</span><span class="dt">"configuration"</span><span class="fu">:{</span><span class="dt">"security"</span><span class="fu">:{</span><span class="dt">"samlActivated"</span><span class="fu">:</span><span class="kw">false</span><span class="fu">,</span><span class="dt">"enabled"</span><span class="fu">:</span><span class="kw">false</span><span class="fu">,</span><span class="dt">"samlEnabled"</span><span class="fu">:</span><span class="kw">false</span><span class="fu">},</span><span class="dt">"vocabulary"</span><span class="fu">:{</span><span class="dt">"solrEnabled"</span><span class="fu">:</span><span class="kw">true</span><span class="fu">},</span><span class="dt">"person"</span><span class="fu">:{</span><span class="dt">"viewDatesPermitted"</span><span class="fu">:</span><span class="kw">false</span><span class="fu">},</span><span class="dt">"plugins"</span><span class="fu">:{</span><span class="dt">"atlasgisEnabled"</span><span class="fu">:</span><span class="kw">false</span><span class="fu">},</span><span class="dt">"heracles"</span><span class="fu">:{</span><span class="dt">"smallCellCount"</span><span class="fu">:</span><span class="st">"5"</span><span class="fu">}}}</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="create-webapi-tables">Create WebAPI tables<a class="anchor" aria-label="anchor" href="#create-webapi-tables"></a>
</h3>
<p>Creates the required WebAPI tables based on the CDM data and insert source records for the connection to the AmsterdamUMCdb CDM.</p>
<p>From the R console, run:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">amstel</span><span class="fu">::</span><span class="fu"><a href="reference/create_webapi_tables.html">create_webapi_tables</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Refresh WebAPI to show the added CDM instance: <a href="http://localhost:8080/WebAPI/source/refresh" class="external-link uri">http://localhost:8080/WebAPI/source/refresh</a></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="ot">[</span><span class="fu">{</span><span class="dt">"sourceId"</span><span class="fu">:</span><span class="dv">3</span><span class="fu">,</span><span class="dt">"sourceName"</span><span class="fu">:</span><span class="st">"Amsterdam University Medical Centers Database v1.0.2"</span><span class="fu">,</span><span class="dt">"sourceDialect"</span><span class="fu">:</span><span class="st">"postgresql"</span><span class="fu">,</span><span class="dt">"sourceKey"</span><span class="fu">:</span><span class="st">"AmsterdamUMCdb v1.0.2"</span><span class="fu">,</span><span class="dt">"daimons"</span><span class="fu">:</span><span class="ot">[</span><span class="fu">{</span><span class="dt">"sourceDaimonId"</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">"daimonType"</span><span class="fu">:</span><span class="st">"CDM"</span><span class="fu">,</span><span class="dt">"tableQualifier"</span><span class="fu">:</span><span class="st">"cdm_54"</span><span class="fu">,</span><span class="dt">"priority"</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span><span class="ot">,</span><span class="fu">{</span><span class="dt">"sourceDaimonId"</span><span class="fu">:</span><span class="dv">3</span><span class="fu">,</span><span class="dt">"daimonType"</span><span class="fu">:</span><span class="st">"Vocabulary"</span><span class="fu">,</span><span class="dt">"tableQualifier"</span><span class="fu">:</span><span class="st">"cdm_54"</span><span class="fu">,</span><span class="dt">"priority"</span><span class="fu">:</span><span class="dv">1</span><span class="fu">}</span><span class="ot">,</span><span class="fu">{</span><span class="dt">"sourceDaimonId"</span><span class="fu">:</span><span class="dv">4</span><span class="fu">,</span><span class="dt">"daimonType"</span><span class="fu">:</span><span class="st">"Results"</span><span class="fu">,</span><span class="dt">"tableQualifier"</span><span class="fu">:</span><span class="st">"cdm_results"</span><span class="fu">,</span><span class="dt">"priority"</span><span class="fu">:</span><span class="dv">1</span><span class="fu">}</span><span class="ot">,</span><span class="fu">{</span><span class="dt">"sourceDaimonId"</span><span class="fu">:</span><span class="dv">5</span><span class="fu">,</span><span class="dt">"daimonType"</span><span class="fu">:</span><span class="st">"Temp"</span><span class="fu">,</span><span class="dt">"tableQualifier"</span><span class="fu">:</span><span class="st">"cdm_temp"</span><span class="fu">,</span><span class="dt">"priority"</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span><span class="ot">]</span><span class="fu">}</span><span class="ot">]</span></span></code></pre></div>
<p>You can check the current sources by opening: <a href="http://localhost:8080/WebAPI/source/sources" class="external-link uri">http://localhost:8080/WebAPI/source/sources</a></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="ot">[</span><span class="fu">{</span><span class="dt">"sourceId"</span><span class="fu">:</span><span class="dv">3</span><span class="fu">,</span><span class="dt">"sourceName"</span><span class="fu">:</span><span class="st">"Amsterdam University Medical Centers Database v1.0.2"</span><span class="fu">,</span><span class="dt">"sourceDialect"</span><span class="fu">:</span><span class="st">"postgresql"</span><span class="fu">,</span><span class="dt">"sourceKey"</span><span class="fu">:</span><span class="st">"AmsterdamUMCdb v1.0.2"</span><span class="fu">,</span><span class="dt">"daimons"</span><span class="fu">:</span><span class="ot">[</span><span class="fu">{</span><span class="dt">"sourceDaimonId"</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">"daimonType"</span><span class="fu">:</span><span class="st">"CDM"</span><span class="fu">,</span><span class="dt">"tableQualifier"</span><span class="fu">:</span><span class="st">"cdm_54"</span><span class="fu">,</span><span class="dt">"priority"</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span><span class="ot">,</span><span class="fu">{</span><span class="dt">"sourceDaimonId"</span><span class="fu">:</span><span class="dv">3</span><span class="fu">,</span><span class="dt">"daimonType"</span><span class="fu">:</span><span class="st">"Vocabulary"</span><span class="fu">,</span><span class="dt">"tableQualifier"</span><span class="fu">:</span><span class="st">"cdm_54"</span><span class="fu">,</span><span class="dt">"priority"</span><span class="fu">:</span><span class="dv">1</span><span class="fu">}</span><span class="ot">,</span><span class="fu">{</span><span class="dt">"sourceDaimonId"</span><span class="fu">:</span><span class="dv">4</span><span class="fu">,</span><span class="dt">"daimonType"</span><span class="fu">:</span><span class="st">"Results"</span><span class="fu">,</span><span class="dt">"tableQualifier"</span><span class="fu">:</span><span class="st">"cdm_results"</span><span class="fu">,</span><span class="dt">"priority"</span><span class="fu">:</span><span class="dv">1</span><span class="fu">}</span><span class="ot">,</span><span class="fu">{</span><span class="dt">"sourceDaimonId"</span><span class="fu">:</span><span class="dv">5</span><span class="fu">,</span><span class="dt">"daimonType"</span><span class="fu">:</span><span class="st">"Temp"</span><span class="fu">,</span><span class="dt">"tableQualifier"</span><span class="fu">:</span><span class="st">"cdm_temp"</span><span class="fu">,</span><span class="dt">"priority"</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span><span class="ot">]</span><span class="fu">}</span><span class="ot">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="install-apache-webserver">Install Apache Webserver<a class="anchor" aria-label="anchor" href="#install-apache-webserver"></a>
</h2>
<p>The OHDSI Setup guide does not suggest a default setup. For Apache 2 Webserver:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="fu">sudo</span> apt install apache2</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="install-nodejs">Install NodeJS<a class="anchor" aria-label="anchor" href="#install-nodejs"></a>
</h2>
<ol style="list-style-type: decimal">
<li>Download and import the Nodesource GPG key</li>
</ol>
<div class="sourceCode" id="cb32"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="fu">sudo</span> apt-get update</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a><span class="fu">sudo</span> apt-get install <span class="at">-y</span> ca-certificates curl gnupg</span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a><span class="fu">sudo</span> mkdir <span class="at">-p</span> /etc/apt/keyrings</span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-fsSL</span> https://deb.nodesource.com/gpgkey/nodesource-repo.gpg.key <span class="kw">|</span> <span class="fu">sudo</span> gpg <span class="at">--dearmor</span> <span class="at">-o</span> /etc/apt/keyrings/nodesource.gpg</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Create deb repository</li>
</ol>
<div class="sourceCode" id="cb33"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="va">NODE_MAJOR</span><span class="op">=</span>21</span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"deb [signed-by=/etc/apt/keyrings/nodesource.gpg] https://deb.nodesource.com/node_</span><span class="va">$NODE_MAJOR</span><span class="st">.x nodistro main"</span> <span class="kw">|</span> <span class="fu">sudo</span> tee /etc/apt/sources.list.d/nodesource.list</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Run Update and Install</li>
</ol>
<div class="sourceCode" id="cb34"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="fu">sudo</span> apt-get update</span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a><span class="fu">sudo</span> apt-get install nodejs <span class="at">-y</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="install-ohdsi-atlas">Install OHDSI ATLAS<a class="anchor" aria-label="anchor" href="#install-ohdsi-atlas"></a>
</h2>
<ol style="list-style-type: decimal">
<li>Download the lastest release</li>
</ol>
<div class="sourceCode" id="cb35"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="bu">cd</span> ~/git</span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/OHDSI/ATLAS.git</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Checkout latest release</li>
</ol>
<div class="sourceCode" id="cb36"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="bu">cd</span> ATLAS/</span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a><span class="fu">git</span> fetch <span class="at">--tags</span></span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a><span class="va">latestTag</span><span class="op">=</span><span class="va">$(</span><span class="fu">git</span> describe <span class="at">--tags</span> <span class="kw">`</span><span class="fu">git</span> rev-list <span class="at">--tags</span> <span class="at">--max-count</span><span class="op">=</span>1<span class="kw">`</span><span class="va">)</span></span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a><span class="fu">git</span> checkout <span class="va">$latestTag</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Build latest release</li>
</ol>
<div class="sourceCode" id="cb37"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="ex">npm</span> run build</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Copy ATLAS build to Apache Webserver</li>
</ol>
<div class="sourceCode" id="cb38"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="fu">sudo</span> cp <span class="at">-r</span> ./ /var/www/html/atlas/</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="run-atlas">Run ATLAS<a class="anchor" aria-label="anchor" href="#run-atlas"></a>
</h2>
<p>Navigate to <a href="http://localhost/atlas" class="external-link uri">http://localhost/atlas</a>. You should now have a running instance of ATLAS and should be able to browse aggregated data and perform analyses.</p>
</div>
</div>
<div class="section level1">
<h1 id="dataqualitydashboard-thresholds">DataQualityDashboard Thresholds<a class="anchor" aria-label="anchor" href="#dataqualitydashboard-thresholds"></a>
</h1>
<p><em>Development only</em></p>
<p>While the default DQD thresholds have been chosen by OHDSI community experts, they may not be appropriate for the source database. To change, these thresholds:</p>
<ol style="list-style-type: decimal">
<li>clone the repository:</li>
</ol>
<div class="sourceCode" id="cb39"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/OHDSI/DataQualityDashboard.git</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>copy the CDM v5.4 control files to the <code>dqd</code> folder of the AMSTEL repository, e.g.:</li>
</ol>
<div class="sourceCode" id="cb40"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="fu">cp</span> DataQualityDashboard/inst/csv/OMOP_CDMv5.4<span class="pp">*</span> AMSTEL/data/dqd</span></code></pre></div>
</div>
<div class="section level1">
<h1 id="cdminspection">CdmInspection<a class="anchor" aria-label="anchor" href="#cdminspection"></a>
</h1>
<p><em>Development only</em></p>
<p><a href="https://github.com/EHDEN/CdmInspection" class="external-link">EHDEN CdmInspection</a> is an R R Package to support quality control inspection of an OMOP-CDM instance.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<ol style="list-style-type: decimal">
<li>Install libcairo</li>
</ol>
<div class="sourceCode" id="cb41"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="fu">sudo</span> apt-get install libcairo2-dev</span></code></pre></div>
<p>From an R console, run:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"EHDEN/CdmInspection"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level1">
<h1 id="publish-dataqualitydashboard-results">Publish DataQualityDashboard results<a class="anchor" aria-label="anchor" href="#publish-dataqualitydashboard-results"></a>
</h1>
<p><em>Development only</em></p>
<p>This uses the web application that is part of the OHDSI Data Quality Dashboard shiny app to display the results in the GitHub pages documentation, but without the R (server) dependencies. The most recent published OHDSI DataQualityDashboard results can be found <a href="https://amsterdamumc.github.io/AMSTEL/dqd/index.html">here</a>.</p>
<p>Copy the required files from the cloned repository to the <code>docs</code> folder of <code>AMSTEL</code>:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a><span class="fu">cp</span> DataQualityDashboard/inst/shinyApps/www/ AMSTEL/docs/dqd <span class="at">-r</span></span></code></pre></div>
<p>Remove the example files:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a><span class="fu">rm</span> AMSTEL/docs/dqd/results<span class="pp">*</span></span></code></pre></div>
<p>Copy the most recent results file (<code>amsterdamumcdb v1.0.2-&lt;timestamp&gt;.json)</code>) to <code>results.json</code>, e.g.:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a><span class="fu">cp</span> AMSTEL/data/dqd/amsterdamumcdb\ v1.0.2-20240317194413.json AMSTEL/docs/dqd/results.json</span></code></pre></div>
</div>
<div class="section level1">
<h1 id="run-catalogueexport">Run catalogueExport<a class="anchor" aria-label="anchor" href="#run-catalogueexport"></a>
</h1>
<p><em>Development only</em></p>
<p>The <a href="https://github.com/EHDEN/CatalogueExport" class="external-link">EHDEN CatalogueExport</a> exports the data from the OMOP-CDM that is necessary for the EHDEN Database Catalogue available at <a href="https://portal.ehden.eu/" class="external-link uri">https://portal.ehden.eu/</a>.</p>
<p>From an R console, run:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"EHDEN/CatalogueExport"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level1">
<h1 id="trivia">Trivia<a class="anchor" aria-label="anchor" href="#trivia"></a>
</h1>
<p>AMSTEL: an anagram of AMS (Amsterdam) ETL (Extract, Transform, and Load), named after the river flowing through the city of Amsterdam</p>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/AmsterdamUMC/AMSTEL/" class="external-link">Browse source code</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing amstel</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Patrick Thoral <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-6140-7195" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Paul Elbers <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0003-0447-6893" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Amsterdam UMC <br><small class="roles"> Author </small>  </li>
<li>Amsterdam Medical Data Science <br><small class="roles"> Author </small>  </li>
<li>Stichting LaLa <br><small class="roles"> Author </small>  </li>
<li>Gaia Scientific <br><small class="roles"> Author </small>  </li>
<li>EHDEN Foundation <br><small class="roles"> Funder </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Patrick Thoral, Paul Elbers, Amsterdam UMC, Amsterdam Medical Data Science, Stichting LaLa, Gaia Scientific, EHDEN Foundation.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
